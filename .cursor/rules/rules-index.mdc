---
description: Central index of all Cursor rules in this project - explains purpose and when to use each rule file
globs: 
alwaysApply: true
---

# Rules Index - ElectricalDiagramAnalyzer

This document provides an overview of all Cursor rule files in this project and when to apply them.

## Core Rules

| File | Purpose | When to Use |
|------|---------|-------------|
| [core/dev-environment.mdc](mdc:.cursor/rules/core/dev-environment.mdc) | Virtual environment activation requirement | Always applied - activate venv before running Python |
| [core/documentation-standards.mdc](mdc:.cursor/rules/core/documentation-standards.mdc) | Documentation standards and post-implementation checklist | Always applied - enforces documentation updates |
| [core/code-reusability.mdc](mdc:.cursor/rules/core/code-reusability.mdc) | DRY principles - avoid duplication, create reusable code | Always applied - enforces code reusability |
| [core/proactive-suggestions.mdc](mdc:.cursor/rules/core/proactive-suggestions.mdc) | Present better alternatives with pros/cons before implementing | Always applied - AI suggests improvements |
| [cursor-rules.mdc](mdc:.cursor/rules/cursor-rules.mdc) | How to create/edit Cursor rules | When creating or modifying rule files in `.cursor/rules/` |
| [self-improve.mdc](mdc:.cursor/rules/self-improve.mdc) | Guidelines for improving rules based on code patterns | Continuously monitor for new patterns that should become rules |

## Documentation Rules

| File | Purpose | When to Use |
|------|---------|-------------|
| [docs/documentation-router.mdc](mdc:.cursor/rules/docs/documentation-router.mdc) | Quick lookup for functions, classes, and patterns | When searching for where something is documented |
| [docs/application-overview.mdc](mdc:.cursor/rules/docs/application-overview.mdc) | High-level architecture and module summary | When understanding the overall system or onboarding |
| [docs/uplink-server.mdc](mdc:.cursor/rules/docs/uplink-server.mdc) | Anvil Uplink server API and job processing | When working on `AnvilUplinkCode/` or understanding the backend |
| [docs/panel-detection.mdc](mdc:.cursor/rules/docs/panel-detection.mdc) | Visual panel detection tools | When working on `VisualDetectionToolLibrary/` |
| [docs/ocr-library.mdc](mdc:.cursor/rules/docs/ocr-library.mdc) | OCR parsing and table extraction | When working on `OcrLibrary/` or `AnchoringClasses/` |
| [docs/rules-engine.mdc](mdc:.cursor/rules/docs/rules-engine.mdc) | Business rules and part number selection | When working on `RulesEngine/` or `PartNumberSelector/` |
| [docs/page-filter.mdc](mdc:.cursor/rules/docs/page-filter.mdc) | PDF page filtering for electrical sheets | When working on `PageFilter/` |

## Common Errors

| File | Purpose | When to Use |
|------|---------|-------------|
| [common-errors/_template.mdc](mdc:.cursor/rules/common-errors/_template.mdc) | Template for documenting new errors | When adding a new error to documentation |
| [common-errors/ocr-errors.mdc](mdc:.cursor/rules/common-errors/ocr-errors.mdc) | OCR-related errors and solutions | When debugging OCR or parsing issues |
| [common-errors/image-processing-errors.mdc](mdc:.cursor/rules/common-errors/image-processing-errors.mdc) | OpenCV and image processing errors | When debugging image/PDF processing |

## Reference Documents

| File | Purpose | When to Use |
|------|---------|-------------|
| [reference/project-structure.mdc](mdc:.cursor/rules/reference/project-structure.mdc) | Complete directory and file listing | When navigating the codebase or finding files |
| [potential-problems.mdc](mdc:.cursor/rules/potential-problems.mdc) | Known issues, technical debt, and codebase problems | Before making changes, during debugging, or when onboarding |

## Project Structure Overview

```
ElectricalDiagramAnalyzer/
├── AnvilUplinkCode/          # Backend server connecting to Anvil platform
│   └── uplink_server.py      # Main server entry point
├── VisualDetectionToolLibrary/  # Panel/table detection from PDFs
│   └── PanelSearchToolV21.py    # Latest panel search implementation
├── OcrLibrary/               # OCR parsing and breaker table extraction
│   ├── BreakerTableAnalyzer12.py  # Analyzes table structure
│   ├── BreakerTableParser*.py     # Parses breaker data from tables
│   ├── BreakerTableParserAPIv3.py # Unified pipeline API
│   └── PanelHeaderParserV4.py     # Panel header text parsing
├── AnchoringClasses/         # Header/footer boundary detection
│   ├── BreakerHeaderFinder.py
│   └── BreakerFooterFinder.py
├── PageFilter/               # PDF page filtering by content type
│   ├── PageFilter.py
│   └── PageFilterV2.py       # Current version with OCR + footprints
├── RulesEngine/              # Business logic for panel configuration
│   └── RulesEngine2.py       # Main rules engine
├── PartNumberSelector/       # Part number generation
│   └── PartNumberBuilder.py  # Disconnect, breaker, panel builders
├── DevEnv/                   # Development/testing scripts
└── Backups/                  # Historical backups (reference only)
```

## Common Tasks Quick Reference

### Modifying Panel Detection
- Primary file: `VisualDetectionToolLibrary/PanelSearchToolV21.py`
- Class: `PanelBoardSearch`
- Entry point: `readPdf()` method
- Related docs: [panel-detection.mdc](mdc:.cursor/rules/docs/panel-detection.mdc)

### Modifying OCR/Parsing
- Pipeline: `OcrLibrary/BreakerTableParserAPIv3.py` → `BreakerTablePipeline`
- Analyzer: `OcrLibrary/BreakerTableAnalyzer12.py` → `BreakerTableAnalyzer`
- Parser: `OcrLibrary/BreakerTableParser5.py` → `BreakerTableParser`
- Related docs: [ocr-library.mdc](mdc:.cursor/rules/docs/ocr-library.mdc)

### Modifying Page Filtering
- Primary file: `PageFilter/PageFilterV2.py`
- Class: `PageFilter`
- Entry point: `readPdf()` method
- Related docs: [page-filter.mdc](mdc:.cursor/rules/docs/page-filter.mdc)

### Modifying Rules/Part Numbers
- Rules: `RulesEngine/RulesEngine2.py`
- Entry point: `process_job(payload)` function
- Part numbers: `PartNumberSelector/PartNumberBuilder.py`
- Related docs: [rules-engine.mdc](mdc:.cursor/rules/docs/rules-engine.mdc)

### Modifying Server/API
- Primary file: `AnvilUplinkCode/uplink_server.py`
- Anvil callable functions prefixed with `vm_*`
- Related docs: [uplink-server.mdc](mdc:.cursor/rules/docs/uplink-server.mdc)

## Key Dependencies

- **EasyOCR**: Text recognition from panel images
- **PyMuPDF (fitz)**: PDF rendering and manipulation
- **OpenCV (cv2)**: Image processing and analysis
- **NumPy**: Numerical operations
- **Anvil**: Backend platform connection

## Version Naming Convention

Files with version suffixes (e.g., `V21`, `V12`) indicate iteration history:
- **Always use the highest version number** for active development
- Lower versions are kept for reference/rollback
- Check imports in `uplink_server.py` for currently active versions
